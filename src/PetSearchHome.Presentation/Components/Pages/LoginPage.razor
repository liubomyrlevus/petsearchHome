@page "/login"
@page "/"
@inject ViewModels.LoginViewModel ViewModel
@inject NavigationManager NavigationManager
@implements IDisposable

<PageTitle>Вхід</PageTitle>

<div class="page-container auth-page">
    <EditForm class="login-form" Model="ViewModel" OnValidSubmit="ViewModel.LoginCommand.ExecuteAsync">
        <DataAnnotationsValidator />

        <h3>Ласкаво просимо до PetSearchHome</h3>

        <div class="form-field">
            <label for="emailInput">Email</label>
            <InputText id="emailInput"
                       @bind-Value="ViewModel.Email"
                       type="email"
                       placeholder="example@gmail.com" />
            <ValidationMessage For="@(() => ViewModel.Email)" />
        </div>

        <div class="form-field">
            <label for="passwordInput">Пароль</label>
            <InputText id="passwordInput"
                       @bind-Value="ViewModel.Password"
                       type="password"
                       placeholder="Введіть ваш пароль" />
            <ValidationMessage For="@(() => ViewModel.Password)" />
        </div>

        <div class="form-footer">
            <span class="text-muted small">Введіть свої дані, щоб продовжити</span>
        </div>

        @if (!string.IsNullOrEmpty(ViewModel.ErrorMessage))
        {
            <div class="error-message">@ViewModel.ErrorMessage</div>
        }

        <div class="actions">
            <button type="submit" class="primary" disabled="@(!ViewModel.CanLogin)">
                @if (ViewModel.IsBusy)
                {
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                }
                else
                {
                    <span>Увійти</span>
                }
            </button>
            <button type="button" @onclick="GoToRegister">Зареєструватися</button>
        </div>
    </EditForm>
</div>

@code {
    private System.ComponentModel.PropertyChangedEventHandler? _handler;

    protected override void OnInitialized()
    {
        _handler = (_, _) => InvokeAsync(StateHasChanged);
        ViewModel.PropertyChanged += _handler;
    }

    private void GoToRegister()
    {
        NavigationManager.NavigateTo("/register");
    }

    public void Dispose()
    {
        if (_handler is not null)
        {
            ViewModel.PropertyChanged -= _handler;
        }
    }
}
